# --- Basic Information for pysior---
pysiral_package_config:
  id: &l1p_id "cryosat2_l1b_default"
  version: &l1p_version 1.2
  supported_source_datasets:
    - "cryosat2_nrt_esa_iceb0E"
    - "cryosat2_rep_esa_iceb0E"

output: 
  id: *l1p_id
  version: *l1p_version

# Settings for the pre-processor
level1_preprocessor:

    polar_ocean:
        target_hemisphere: [north, south]
        polar_latitude_threshold: 45.0
        input_file_is_single_hemisphere: False
        allow_nonocean_segment_nrecords: 1000

    orbit_segment_connectivity:
        max_connected_segment_timedelta_seconds: 10

    # NOTE: if no options are required use an empty mapping {} instead of null!
    processing_items:

        # Compute pulse peakiness
        - label: "Compute Pulse Peakiness"
          stage: post_ocean_segment_extraction
          module_name: pysiral.waveform
          class_name: L1PWaveformPeakiness
          options:
              skip_first_range_bins: 0
              norm_is_range_bin: True

        # Compute normed pulse peakiness
        - label: "Compute Pulse Peakiness (normed)"
          stage: post_ocean_segment_extraction
          module_name: pysiral.waveform
          class_name: L1PWaveformPeakiness
          options:
              skip_first_range_bins: 0
              norm_is_range_bin: False

        # Resample SIN waveforms to the same size as SAR waveforms
        # NOTE: This will only have an effect of SIN segments
        - label: "Resample SIN waveforms"
          stage: post_ocean_segment_extraction
          module_name: pysiral.cryosat2.functions
          class_name: L1PWaveformResampleSIN
          options:
              sin_target_bins: 256

        # Pad LRM waveforms to the same size as SAR waveforms
        # NOTE: This will only have an effect of LRM segments
        - label: "Pad LRM waveforms"
          stage: post_ocean_segment_extraction
          module_name: pysiral.cryosat2.functions
          class_name: L1PWaveformPadLRM
          options:
              lrm_target_bins: 256

        # Compute the leading edge width parameters (full, first half & second half)
        - label: "Compute Leading Edge Width"
          stage: post_ocean_segment_extraction
          module_name: pysiral.waveform
          class_name: L1PLeadingEdgeWidth
          options:
              tfmra_leading_edge_start: 0.05
              tfmra_leading_edge_center: 0.5
              tfmra_leading_edge_end: 0.95
              tfmra_options:
                noise_level_range_bin_idx: [0, 5]
                wfm_smoothing_window_size: [11, 11, 21]
                first_maximum_ignore_leading_bins: 0

        # Compute the leading edge quality indicator
        # This class will add three parameters to the l1p classifier data group:
        #  1. Leading edge quality
        #  2. first maximum index
        #  3. first maximum power (in units of peak power)
        - label: "Compute Leading Edge Quality"
          stage: post_ocean_segment_extraction
          module_name: pysiral.waveform
          class_name: L1PLeadingEdgeQuality
          options:
            # Power threshold for the normalized waveform
            # that the first maximum has to exceed
            first_maximum_normalized_power_threshold:
                lrm: 0.5
                sar: 0.25
                sin: 0.25
            # Number of range bins prior to the first maximum
            # that are to compute the quality factor
            leading_edge_lookup_window:
                lrm: 20
                sar: 30
                sin: 60
            # Minimum valid first maximum index
            minimum_valid_first_maximum_index:
                lrm: 10
                sar: 10
                sin: 10

        # Compute waveform backscatter coeficient (sigma0)
        - label: "Compute Sigma0"
          stage: post_ocean_segment_extraction
          module_name: pysiral.cryosat2.functions
          class_name: L1PCryoSat2Sigma0
          options:

              # CryoSat-2 altimeter constants to compute the LRM footprint
              footprint_pl_kwargs:
                  band_width: 320000000.

              # CryoSat-2 altimeter constants to compute the SAR footprint
              footprint_sar_kwargs:
                  ptr_width: 2.819e-09
                  tau_b: 0.00352
                  lambda_0: 0.022084
                  wf: 1.0

              # CryoSat-2 altimeter constants to compute sigma0
              sigma0_sar_kwargs:
                  lambda_0: 0.022084
                  g_0: 19054.607179632483

              # CryoSat-2 radar mode sigma0 biases
              sigma0_bias: [0.0, 0.0, 0.0]

        # Compute the leading edge peakiness
        # This class will add three parameters to the l1p classifier data group:
        #  1. Leading edge peakiness
        - label: "Compute Leading Edge Peakiness"
          stage: post_ocean_segment_extraction
          module_name: pysiral.waveform
          class_name: L1PLeadingEdgePeakiness
          options:
            # Power threshold for the normalized waveform
            # that the first maximum has to exceed
            window_size: 3